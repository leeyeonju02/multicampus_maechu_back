<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.multipjt.multi_pjt.record.diet.dao.DietMapper">

    <!-- dietRow --> 

    <insert id="dietInsert" parameterType="com.multipjt.multi_pjt.record.diet.domain.DietRequestDTO">
        insert into DietRecords(meal_type,member_id)
        values(#{mealType},#{member_id});
    </insert>



    <!-- itemRow --> 

    <insert id="itemInsert" parameterType="com.multipjt.multi_pjt.record.diet.domain.ItemRequestDTO">
        insert into DietItems(item_name,quantity,carbs,protein,fat,calories,diet_id)
        values(#{item_name},#{quantity},#{carbs},#{protein},#{fat},#{calories},#{dietId}); 
    </insert>    

    <!-- findDietNumber --> 

    <select id="findDietNumber" parameterType="java.util.Map" resultType="java.lang.Long">
    select diet_id from DietRecords
    where member_id = #{member_id} and record_date = #{recordDate} and meal_type = #{mealType}
</select>

    <!-- dietDelete --> 

    <delete id="dietDelete" parameterType="java.lang.Long">
        delete from DietRecords
        where diet_id = #{dietId};
    </delete>

    <!-- itemDelete --> 

    <delete id="itemDelete" parameterType="java.util.Map">
        delete from DietItems
        where item_name = #{itemName} and diet_id = #{dietId};
    </delete>    

    <!-- itemFindAll --> 

    <select id="itemFindAll" parameterType="java.lang.Long" resultType="com.multipjt.multi_pjt.record.diet.domain.ItemResponseDTO">
        select * from DietItems
        where diet_id = #{dietId};
    </select>

    <!-- itemUpdate --> 

    <update id="itemUpdate" parameterType="java.util.Map">
        update DietItems
        set item_name = #{newItemName},
        calories = #{calories},
        carbs = #{carbs},
        fat = #{fat},
        protein = #{protein}
        where item_name = #{itemName} and diet_id = #{dietId};
    </update>    

    <!-- itemNutCheck --> 

    <select id="itemNutCheck" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT 
            d.meal_type AS mealType,
            SUM(i.calories) AS totalCalories,
            SUM(i.carbs) AS totalCarbs,
            SUM(i.protein) AS totalProtein,
            SUM(i.fat) AS totalFat
        FROM DietRecords d
        JOIN DietItems i
            ON d.diet_id = i.diet_id
        WHERE d.record_date = #{recordDate}
            AND d.member_id = #{memberId}
        GROUP BY d.meal_type;
    </select>
    
</mapper>